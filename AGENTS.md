# Project Agents.md Guide for OpenAI Codex

This Agents.md file provides comprehensive guidance for OpenAI Codex and other AI agents working with this codebase.
This project is aimed to develop a general minecraft launcher, with a focus on modding and customization, and with the full flexibility of MultiMC type launchers for instance.

BEFORE FINISHING ANYTHING PLEASE RUN THE FOLLOWING COMMANDS:
```
cargo fmt
cargo check
cargo clippy --fix
```

The project is done using rust, and the iced library, other crates could be added if needed.

## Project Structure for OpenAI Codex Navigation

- `src/` (fastmc app): Iced launcher entrypoint and UI.
  - `main.rs`: App shell, routing, stage gating, and subscription wiring.
  - `screens/`: Screens for the launcher.
    - `account.rs`: Offline + Microsoft device-code auth, account list, activation/deletion.
    - `java_manager.rs`: Java detection/custom path, memory sliders, JVM args, and status banners.
    - `play.rs`: Temporary counter demo; replace with launch UI.
    - `server.rs`, `modpacks.rs`, `settings.rs`: Placeholders awaiting real flows.
    - `mod.rs`: Screen re-exports.
  - `theme.rs`: Shared icon loader and sidebar button styling.
- `assets/`: Static assets (do not modify directly).
  - `svg/`: Navigation icons for sidebar entries.
- `account_manager/`: Crate that owns account persistence, offline creation, Microsoft device-code login, keyring-backed token storage, and Minecraft session retrieval (`src/lib.rs`).
- `config/` (`fastmc_config` crate): Loads/saves `FastmcConfig` (profiles, Java, accounts), handles versioning and migration, and persists JSON config to app data (`src/lib.rs`).
- `java_manager/`: Crate with Java discovery and launch settings.
  - `detection.rs`: Scans system paths/preferred path for Java installations.
  - `settings.rs`: `JavaLaunchSettings` + helpers to sync with config.
  - `lib.rs`: Public exports.
- `launcher/`: Crate that builds the Java command line for vanilla Minecraft, including auth, memory, resolution, natives/classpath, and game args (`src/lib.rs` with tests).
- `microsoft_auth/`: Crate implementing Microsoft OAuth device flow and token handling.
  - `authenticator.rs`: Device-code polling and token acquisition.
  - `errors.rs`: Auth-specific errors.
  - `models.rs`: DTOs for device codes/tokens.
  
## Coding Conventions for OpenAI Codex

### General Conventions for Agents.md Implementation

- Use clean rust code, with no unsafe rust code
- OpenAI Codex should follow the existing code style in each file
- Agents.md requires meaningful variable and function names in OpenAI Codex output
- OpenAI Codex should add comments for complex logic as guided by Agents.md

### fastMC Crate Guidelines for OpenAI Codex

- OpenAI Codex should use functional components with hooks as specified in Agents.md
- Use latest available stable iced code 
- Keep code clean, and well structured, using enums, structs as intended by the iced library
- OpenAI Codex must follow the file naming convention: camelCase.rs

### Microsoft Auth Crate Guidelines for OpenAI Codex

- This crate is designed to manage xbox authentication for Microsoft accounts.
- It provides functions to authenticate users with Microsoft accounts and retrieve their Xbox Live tokens.
- It's aimed to be a library that can be used by other crates to authenticate users with Microsoft accounts and retrieve their Xbox Live tokens.

## Testing Requirements for OpenAI Codex

OpenAI Codex should check that the applications is building with no errors nor warnings with. 

```bash
cargo build
cargo check
cargo clippy
```

## Pull Request Guidelines for OpenAI Codex

When OpenAI Codex helps create a PR, please ensure it:

1. Includes a clear description of the changes as guided by Agents.md
2. References any related issues that OpenAI Codex is addressing
3. Ensures all tests pass for code generated by OpenAI Codex
4. Includes screenshots for UI changes implemented with OpenAI Codex
5. Keeps PRs focused on a single concern as specified in Agents.md

## Programmatic Checks for OpenAI Codex

Before submitting changes generated by OpenAI Codex, run:

```bash
cargo clippy
cargo fmt
cargo test
```

## Current Work Snapshot

- Iced launcher shell with sidebar navigation and stage gating; the app loads `FastmcConfig`, requires at least one account before entering the main UI, and routes messages to dedicated screens.
- Account screen supports offline and Microsoft device-code login via `account_manager`/`microsoft_auth`, persists accounts through `AccountStore`, and allows active selection/deletion with error banners.
- Java Manager screen detects installations, allows custom paths, memory sliders, and JVM args, persists settings back to `FastmcConfig`, and surfaces detection errors/status banners.
- Play screen is a counter demo; Server, Modpacks, and Settings screens are static placeholders awaiting real functionality.
- Shared theme helpers load SVG icons from `assets` and provide styled sidebar buttons to keep navigation consistent.

## Next Instructions

- Replace the Play placeholder with a real launcher flow: version/profile selection, download/install progress, and launch using the selected account and Java settings, persisting choices.
- Build the Server screen to manage server entries (add/edit/remove) and quick-join, reusing the active account and Java configuration where needed.
- Implement the Modpacks screen with provider selection (e.g., local/remote catalogs), browsing/search, install/update/remove flows, and progress/error feedback.
- Flesh out the Settings screen to control global options (theme, data/cache directories, logging/telemetry toggles, account switching) and persist them via `FastmcConfig`.
- Improve account handling with clearer device-code polling states, token refresh/error surfacing, and tests around `AccountStore` persistence and deletion/active selection paths.
- Enhance Java Manager validation (ensure paths exist and are executable), consider periodic/manual re-scan hooks, and add tests for detection/serialization of launch settings.
- Maintain CI hygiene: keep `cargo fmt`, `cargo check`, and `cargo clippy --fix` green, and add unit/integration tests where new logic is introduced.
